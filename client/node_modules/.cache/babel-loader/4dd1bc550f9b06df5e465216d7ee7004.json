{"ast":null,"code":"import _regeneratorRuntime from \"/workspace/nft-ticket-market/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _slicedToArray from \"/workspace/nft-ticket-market/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _asyncToGenerator from \"/workspace/nft-ticket-market/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/workspace/nft-ticket-market/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/workspace/nft-ticket-market/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/workspace/nft-ticket-market/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/workspace/nft-ticket-market/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/workspace/nft-ticket-market/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _assertThisInitialized from \"/workspace/nft-ticket-market/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nvar _jsxFileName = \"/workspace/nft-ticket-market/client/src/components/SecondaryMarket.jsx\";\nimport React, { Component } from 'react';\nimport Web3 from 'web3';\nimport eventFactory from '../proxies/eventFactory';\nimport EventNFT from '../proxies/EventNFT';\nimport EventMarketplace from '../proxies/EventMarketplace';\nimport eventToken from '../proxies/EventToken';\nimport renderNotification from '../utils/notification-handler';\nvar web3;\n\nvar SecondaryMarket = /*#__PURE__*/function (_Component) {\n  _inherits(SecondaryMarket, _Component);\n\n  function SecondaryMarket() {\n    var _this;\n\n    _classCallCheck(this, SecondaryMarket);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(SecondaryMarket).call(this));\n    _this.updateTickets = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      var _event, initiator, nftInstance, saleTickets, renderData;\n\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.prev = 0;\n              _event = _this.state.event;\n              _context2.next = 4;\n              return web3.eth.getCoinbase();\n\n            case 4:\n              initiator = _context2.sent;\n              _context2.next = 7;\n              return EventNFT(_this.state.event);\n\n            case 7:\n              nftInstance = _context2.sent;\n              _context2.next = 10;\n              return nftInstance.methods.getTicketsForSale().call({\n                from: initiator\n              });\n\n            case 10:\n              saleTickets = _context2.sent;\n              _context2.next = 13;\n              return Promise.all(saleTickets.map( /*#__PURE__*/function () {\n                var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(ticketId) {\n                  var _yield$nftInstance$me, purchasePrice, sellingPrice, forSale, eventDetails, _Object$values, _Object$values2, eventName;\n\n                  return _regeneratorRuntime.wrap(function _callee$(_context) {\n                    while (1) {\n                      switch (_context.prev = _context.next) {\n                        case 0:\n                          _context.next = 2;\n                          return nftInstance.methods.getTicketDetails(ticketId).call({\n                            from: initiator\n                          });\n\n                        case 2:\n                          _yield$nftInstance$me = _context.sent;\n                          purchasePrice = _yield$nftInstance$me.purchasePrice;\n                          sellingPrice = _yield$nftInstance$me.sellingPrice;\n                          forSale = _yield$nftInstance$me.forSale;\n                          _context.next = 8;\n                          return eventFactory.methods.getEventDetails(_event).call({\n                            from: initiator\n                          });\n\n                        case 8:\n                          eventDetails = _context.sent;\n                          _Object$values = Object.values(eventDetails), _Object$values2 = _slicedToArray(_Object$values, 1), eventName = _Object$values2[0];\n\n                          if (!forSale) {\n                            _context.next = 12;\n                            break;\n                          }\n\n                          return _context.abrupt(\"return\", /*#__PURE__*/React.createElement(\"tr\", {\n                            key: ticketId,\n                            __self: _assertThisInitialized(_assertThisInitialized(_this)),\n                            __source: {\n                              fileName: _jsxFileName,\n                              lineNumber: 49,\n                              columnNumber: 13\n                            }\n                          }, /*#__PURE__*/React.createElement(\"td\", {\n                            class: \"center\",\n                            __self: _assertThisInitialized(_assertThisInitialized(_this)),\n                            __source: {\n                              fileName: _jsxFileName,\n                              lineNumber: 50,\n                              columnNumber: 15\n                            }\n                          }, eventName), /*#__PURE__*/React.createElement(\"td\", {\n                            class: \"center\",\n                            __self: _assertThisInitialized(_assertThisInitialized(_this)),\n                            __source: {\n                              fileName: _jsxFileName,\n                              lineNumber: 51,\n                              columnNumber: 15\n                            }\n                          }, ticketId), /*#__PURE__*/React.createElement(\"td\", {\n                            class: \"center\",\n                            __self: _assertThisInitialized(_assertThisInitialized(_this)),\n                            __source: {\n                              fileName: _jsxFileName,\n                              lineNumber: 52,\n                              columnNumber: 15\n                            }\n                          }, web3.utils.fromWei(sellingPrice, 'ether')), /*#__PURE__*/React.createElement(\"td\", {\n                            class: \"center\",\n                            __self: _assertThisInitialized(_assertThisInitialized(_this)),\n                            __source: {\n                              fileName: _jsxFileName,\n                              lineNumber: 54,\n                              columnNumber: 15\n                            }\n                          }, /*#__PURE__*/React.createElement(\"button\", {\n                            type: \"submit\",\n                            className: \"custom-btn login-btn\",\n                            onClick: _this.onPurchaseTicket.bind(_assertThisInitialized(_assertThisInitialized(_this)), ticketId, sellingPrice, initiator),\n                            __self: _assertThisInitialized(_assertThisInitialized(_this)),\n                            __source: {\n                              fileName: _jsxFileName,\n                              lineNumber: 54,\n                              columnNumber: 34\n                            }\n                          }, \"Buy\"))));\n\n                        case 12:\n                        case \"end\":\n                          return _context.stop();\n                      }\n                    }\n                  }, _callee);\n                }));\n\n                return function (_x) {\n                  return _ref2.apply(this, arguments);\n                };\n              }()));\n\n            case 13:\n              renderData = _context2.sent;\n\n              _this.setState({\n                renderTickets: renderData\n              });\n\n              _context2.next = 21;\n              break;\n\n            case 17:\n              _context2.prev = 17;\n              _context2.t0 = _context2[\"catch\"](0);\n              renderNotification('danger', 'Error', 'Error wile updating sale tickets');\n              console.log('Error wile updating sale tickets', _context2.t0);\n\n            case 21:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[0, 17]]);\n    }));\n\n    _this.onPurchaseTicket = /*#__PURE__*/function () {\n      var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(ticketId, sellingPrice, initiator) {\n        var marketplace, marketplaceInstance;\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _context3.prev = 0;\n                marketplace = _this.state.marketplace;\n                _context3.next = 4;\n                return EventMarketplace(marketplace);\n\n              case 4:\n                marketplaceInstance = _context3.sent;\n                _context3.next = 7;\n                return eventToken.methods.approve(marketplace, sellingPrice).send({\n                  from: initiator,\n                  gas: 6700000\n                });\n\n              case 7:\n                _context3.next = 9;\n                return marketplaceInstance.methods.secondaryPurchase(ticketId).send({\n                  from: initiator,\n                  gas: 6700000\n                });\n\n              case 9:\n                _context3.next = 11;\n                return _this.updateTickets();\n\n              case 11:\n                renderNotification('success', 'Success', 'Ticket purchased for the event successfully!');\n                _context3.next = 18;\n                break;\n\n              case 14:\n                _context3.prev = 14;\n                _context3.t0 = _context3[\"catch\"](0);\n                renderNotification('danger', 'Error', _context3.t0.message);\n                console.log('Error while purchasing the ticket', _context3.t0);\n\n              case 18:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, null, [[0, 14]]);\n      }));\n\n      return function (_x2, _x3, _x4) {\n        return _ref3.apply(this, arguments);\n      };\n    }();\n\n    _this.updateEvents = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5() {\n      var initiator, activeEvents, eventDetails, renderData;\n      return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              _context5.prev = 0;\n              _context5.next = 3;\n              return web3.eth.getCoinbase();\n\n            case 3:\n              initiator = _context5.sent;\n              _context5.next = 6;\n              return eventFactory.methods.getActiveEvents().call({\n                from: initiator\n              });\n\n            case 6:\n              activeEvents = _context5.sent;\n              _context5.next = 9;\n              return eventFactory.methods.getEventDetails(activeEvents[0]).call({\n                from: initiator\n              });\n\n            case 9:\n              eventDetails = _context5.sent;\n              _context5.next = 12;\n              return Promise.all(activeEvents.map( /*#__PURE__*/function () {\n                var _ref5 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(fest, i) {\n                  var eventDetails;\n                  return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n                    while (1) {\n                      switch (_context4.prev = _context4.next) {\n                        case 0:\n                          _context4.next = 2;\n                          return eventFactory.methods.getEventDetails(activeEvents[i]).call({\n                            from: initiator\n                          });\n\n                        case 2:\n                          eventDetails = _context4.sent;\n                          return _context4.abrupt(\"return\", /*#__PURE__*/React.createElement(\"option\", {\n                            key: event,\n                            value: fest,\n                            __self: _assertThisInitialized(_assertThisInitialized(_this)),\n                            __source: {\n                              fileName: _jsxFileName,\n                              lineNumber: 91,\n                              columnNumber: 11\n                            }\n                          }, eventDetails[0]));\n\n                        case 4:\n                        case \"end\":\n                          return _context4.stop();\n                      }\n                    }\n                  }, _callee4);\n                }));\n\n                return function (_x5, _x6) {\n                  return _ref5.apply(this, arguments);\n                };\n              }()));\n\n            case 12:\n              renderData = _context5.sent;\n\n              _this.setState({\n                events: renderData,\n                fest: activeEvents[0],\n                marketplace: eventDetails[4],\n                eventName: eventDetails[0]\n              });\n\n              _context5.next = 20;\n              break;\n\n            case 16:\n              _context5.prev = 16;\n              _context5.t0 = _context5[\"catch\"](0);\n              renderNotification('danger', 'Error', 'Error while updating the events');\n              console.log('Error while updating the events', _context5.t0);\n\n            case 20:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, _callee5, null, [[0, 16]]);\n    }));\n\n    _this.onEventChangeHandler = /*#__PURE__*/function () {\n      var _ref6 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee6(e) {\n        var state, event, initiator, eventDetails;\n        return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                state = _this.state;\n                state[e.target.name] = e.target.value;\n\n                _this.setState(state);\n\n                event = _this.state.event;\n                _context6.next = 6;\n                return web3.eth.getCoinbase();\n\n              case 6:\n                initiator = _context6.sent;\n                _context6.next = 9;\n                return eventFactory.methods.getEventDetails(event).call({\n                  from: initiator\n                });\n\n              case 9:\n                eventDetails = _context6.sent;\n\n                _this.setState({\n                  marketplace: eventDetails[4]\n                });\n\n                _context6.next = 13;\n                return _this.updateTickets();\n\n              case 13:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6);\n      }));\n\n      return function (_x7) {\n        return _ref6.apply(this, arguments);\n      };\n    }();\n\n    _this.inputChangedHandler = function (e) {\n      var state = _this.state;\n      console.log('input', e.target.name, e.target.value);\n      state[e.target.name] = e.target.value;\n\n      _this.setState(state);\n    };\n\n    _this.state = {\n      tickets: [],\n      events: [],\n      ticket: null,\n      event: null,\n      marketplace: null,\n      price: null,\n      renderTickets: []\n    };\n    web3 = new Web3(window.ethereum);\n    return _this;\n  }\n\n  _createClass(SecondaryMarket, [{\n    key: \"componentDidMount\",\n    value: function () {\n      var _componentDidMount = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee7() {\n        return _regeneratorRuntime.wrap(function _callee7$(_context7) {\n          while (1) {\n            switch (_context7.prev = _context7.next) {\n              case 0:\n                _context7.next = 2;\n                return this.updateEvents();\n\n              case 2:\n                if (!this.state.event) {\n                  _context7.next = 5;\n                  break;\n                }\n\n                _context7.next = 5;\n                return this.updateTickets();\n\n              case 5:\n              case \"end\":\n                return _context7.stop();\n            }\n          }\n        }, _callee7, this);\n      }));\n\n      function componentDidMount() {\n        return _componentDidMount.apply(this, arguments);\n      }\n\n      return componentDidMount;\n    }()\n  }, {\n    key: \"render\",\n    value: function render() {\n      return /*#__PURE__*/React.createElement(\"div\", {\n        class: \"container center\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 124,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        class: \"row\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 125,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        class: \"container \",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 126,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        class: \"container \",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 127,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(\"h5\", {\n        style: {\n          padding: \"30px 0px 0px 10px\"\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 129,\n          columnNumber: 15\n        }\n      }, \"Secondary Marketplace\"), /*#__PURE__*/React.createElement(\"label\", {\n        class: \"left\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 131,\n          columnNumber: 15\n        }\n      }, \"Event\"), /*#__PURE__*/React.createElement(\"select\", {\n        className: \"browser-default\",\n        name: \"fest\",\n        value: this.state.event || undefined,\n        onChange: this.onEventChangeHandler,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 132,\n          columnNumber: 15\n        }\n      }, /*#__PURE__*/React.createElement(\"option\", {\n        value: \"\",\n        disabled: true,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 133,\n          columnNumber: 17\n        }\n      }, \"Select Event\"), this.state.fests), /*#__PURE__*/React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 135,\n          columnNumber: 24\n        }\n      }), /*#__PURE__*/React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 135,\n          columnNumber: 30\n        }\n      }), /*#__PURE__*/React.createElement(\"h4\", {\n        class: \"center\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 137,\n          columnNumber: 15\n        }\n      }, \"Purchase Tickets\"), /*#__PURE__*/React.createElement(\"table\", {\n        id: \"requests\",\n        class: \"responsive-table striped\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 139,\n          columnNumber: 15\n        }\n      }, /*#__PURE__*/React.createElement(\"thead\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 140,\n          columnNumber: 17\n        }\n      }, /*#__PURE__*/React.createElement(\"tr\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 141,\n          columnNumber: 19\n        }\n      }, /*#__PURE__*/React.createElement(\"th\", {\n        key: \"name\",\n        class: \"center\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 142,\n          columnNumber: 21\n        }\n      }, \"Event Name\"), /*#__PURE__*/React.createElement(\"th\", {\n        key: \"ticketId\",\n        class: \"center\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 143,\n          columnNumber: 21\n        }\n      }, \"Ticket Id\"), /*#__PURE__*/React.createElement(\"th\", {\n        key: \"cost\",\n        class: \"center\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 144,\n          columnNumber: 21\n        }\n      }, \"Cost(in EVENT)\"), /*#__PURE__*/React.createElement(\"th\", {\n        key: \"purchase\",\n        class: \"center\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 145,\n          columnNumber: 21\n        }\n      }, \"Purchase\"))), /*#__PURE__*/React.createElement(\"tbody\", {\n        class: \"striped highlight\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 148,\n          columnNumber: 17\n        }\n      }, this.state.renderTickets))))));\n    }\n  }]);\n\n  return SecondaryMarket;\n}(Component);\n\nexport default SecondaryMarket;","map":{"version":3,"sources":["/workspace/nft-ticket-market/client/src/components/SecondaryMarket.jsx"],"names":["React","Component","Web3","eventFactory","EventNFT","EventMarketplace","eventToken","renderNotification","web3","SecondaryMarket","updateTickets","event","state","eth","getCoinbase","initiator","nftInstance","methods","getTicketsForSale","call","from","saleTickets","Promise","all","map","ticketId","getTicketDetails","purchasePrice","sellingPrice","forSale","getEventDetails","eventDetails","Object","values","eventName","utils","fromWei","onPurchaseTicket","bind","renderData","setState","renderTickets","console","log","marketplace","marketplaceInstance","approve","send","gas","secondaryPurchase","message","updateEvents","getActiveEvents","activeEvents","fest","i","events","onEventChangeHandler","e","target","name","value","inputChangedHandler","tickets","ticket","price","window","ethereum","padding","undefined","fests"],"mappings":";;;;;;;;;;AAAA,OAAOA,KAAP,IAAgBC,SAAhB,QAAiC,OAAjC;AACA,OAAOC,IAAP,MAAiB,MAAjB;AACA,OAAOC,YAAP,MAAyB,yBAAzB;AACA,OAAOC,QAAP,MAAqB,qBAArB;AACA,OAAOC,gBAAP,MAA6B,6BAA7B;AACA,OAAOC,UAAP,MAAuB,uBAAvB;AACA,OAAOC,kBAAP,MAA+B,+BAA/B;AAEA,IAAIC,IAAJ;;IAEMC,e;;;AACJ,6BAAc;AAAA;;AAAA;;AACZ;AADY,UAuBdC,aAvBc,yEAuBE;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAEJC,cAAAA,MAFI,GAEM,MAAKC,KAFX,CAEJD,KAFI;AAAA;AAAA,qBAGYH,IAAI,CAACK,GAAL,CAASC,WAAT,EAHZ;;AAAA;AAGNC,cAAAA,SAHM;AAAA;AAAA,qBAIcX,QAAQ,CAAC,MAAKQ,KAAL,CAAWD,KAAZ,CAJtB;;AAAA;AAINK,cAAAA,WAJM;AAAA;AAAA,qBAKcA,WAAW,CAACC,OAAZ,CAAoBC,iBAApB,GAAwCC,IAAxC,CAA6C;AAAEC,gBAAAA,IAAI,EAAEL;AAAR,eAA7C,CALd;;AAAA;AAKNM,cAAAA,WALM;AAAA;AAAA,qBAMaC,OAAO,CAACC,GAAR,CAAYF,WAAW,CAACG,GAAZ;AAAA,qFAAgB,iBAAMC,QAAN;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iCACIT,WAAW,CAACC,OAAZ,CAAoBS,gBAApB,CAAqCD,QAArC,EAA+CN,IAA/C,CAAoD;AAAEC,4BAAAA,IAAI,EAAEL;AAAR,2BAApD,CADJ;;AAAA;AAAA;AAC3CY,0BAAAA,aAD2C,yBAC3CA,aAD2C;AAC5BC,0BAAAA,YAD4B,yBAC5BA,YAD4B;AACdC,0BAAAA,OADc,yBACdA,OADc;AAAA;AAAA,iCAGxB1B,YAAY,CAACc,OAAb,CAAqBa,eAArB,CAAqCnB,MAArC,EAA4CQ,IAA5C,CAAiD;AAAEC,4BAAAA,IAAI,EAAEL;AAAR,2BAAjD,CAHwB;;AAAA;AAG7CgB,0BAAAA,YAH6C;AAAA,2CAI/BC,MAAM,CAACC,MAAP,CAAcF,YAAd,CAJ+B,uDAI5CG,SAJ4C;;AAAA,+BAM/CL,OAN+C;AAAA;AAAA;AAAA;;AAAA,wEAQ/C;AAAI,4BAAA,GAAG,EAAEJ,QAAT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0CACE;AAAI,4BAAA,KAAK,EAAC,QAAV;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,6BAAoBS,SAApB,CADF,eAEE;AAAI,4BAAA,KAAK,EAAC,QAAV;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,6BAAoBT,QAApB,CAFF,eAGE;AAAI,4BAAA,KAAK,EAAC,QAAV;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,6BAAoBjB,IAAI,CAAC2B,KAAL,CAAWC,OAAX,CAAmBR,YAAnB,EAAiC,OAAjC,CAApB,CAHF,eAKE;AAAI,4BAAA,KAAK,EAAC,QAAV;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0CAAmB;AAAQ,4BAAA,IAAI,EAAC,QAAb;AAAsB,4BAAA,SAAS,EAAC,sBAAhC;AAAuD,4BAAA,OAAO,EAAE,MAAKS,gBAAL,CAAsBC,IAAtB,wDAAiCb,QAAjC,EAA2CG,YAA3C,EAAyDb,SAAzD,CAAhE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mCAAnB,CALF,CAR+C;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBAAhB;;AAAA;AAAA;AAAA;AAAA,kBAAZ,CANb;;AAAA;AAMNwB,cAAAA,UANM;;AAyBZ,oBAAKC,QAAL,CAAc;AAAEC,gBAAAA,aAAa,EAAEF;AAAjB,eAAd;;AAzBY;AAAA;;AAAA;AAAA;AAAA;AA2BZhC,cAAAA,kBAAkB,CAAC,QAAD,EAAW,OAAX,EAAoB,kCAApB,CAAlB;AACAmC,cAAAA,OAAO,CAACC,GAAR,CAAY,kCAAZ;;AA5BY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAvBF;;AAAA,UAuDdN,gBAvDc;AAAA,2EAuDK,kBAAOZ,QAAP,EAAiBG,YAAjB,EAA+Bb,SAA/B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEP6B,gBAAAA,WAFO,GAES,MAAKhC,KAFd,CAEPgC,WAFO;AAAA;AAAA,uBAGmBvC,gBAAgB,CAACuC,WAAD,CAHnC;;AAAA;AAGTC,gBAAAA,mBAHS;AAAA;AAAA,uBAITvC,UAAU,CAACW,OAAX,CAAmB6B,OAAnB,CAA2BF,WAA3B,EAAwChB,YAAxC,EAAsDmB,IAAtD,CAA2D;AAAE3B,kBAAAA,IAAI,EAAEL,SAAR;AAAmBiC,kBAAAA,GAAG,EAAE;AAAxB,iBAA3D,CAJS;;AAAA;AAAA;AAAA,uBAKTH,mBAAmB,CAAC5B,OAApB,CAA4BgC,iBAA5B,CAA8CxB,QAA9C,EAAwDsB,IAAxD,CAA6D;AAAE3B,kBAAAA,IAAI,EAAEL,SAAR;AAAmBiC,kBAAAA,GAAG,EAAE;AAAxB,iBAA7D,CALS;;AAAA;AAAA;AAAA,uBAMT,MAAKtC,aAAL,EANS;;AAAA;AAQfH,gBAAAA,kBAAkB,CAAC,SAAD,EAAY,SAAZ,EAAuB,8CAAvB,CAAlB;AARe;AAAA;;AAAA;AAAA;AAAA;AAUfA,gBAAAA,kBAAkB,CAAC,QAAD,EAAW,OAAX,EAAoB,aAAI2C,OAAxB,CAAlB;AACAR,gBAAAA,OAAO,CAACC,GAAR,CAAY,mCAAZ;;AAXe;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAvDL;;AAAA;AAAA;AAAA;AAAA;;AAAA,UAuEdQ,YAvEc,yEAuEC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBAEa3C,IAAI,CAACK,GAAL,CAASC,WAAT,EAFb;;AAAA;AAELC,cAAAA,SAFK;AAAA;AAAA,qBAGgBZ,YAAY,CAACc,OAAb,CAAqBmC,eAArB,GAAuCjC,IAAvC,CAA4C;AAAEC,gBAAAA,IAAI,EAAEL;AAAR,eAA5C,CAHhB;;AAAA;AAGLsC,cAAAA,YAHK;AAAA;AAAA,qBAIgBlD,YAAY,CAACc,OAAb,CAAqBa,eAArB,CAAqCuB,YAAY,CAAC,CAAD,CAAjD,EAAsDlC,IAAtD,CAA2D;AAAEC,gBAAAA,IAAI,EAAEL;AAAR,eAA3D,CAJhB;;AAAA;AAILgB,cAAAA,YAJK;AAAA;AAAA,qBAKcT,OAAO,CAACC,GAAR,CAAY8B,YAAY,CAAC7B,GAAb;AAAA,qFAAiB,kBAAO8B,IAAP,EAAaC,CAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iCACzBpD,YAAY,CAACc,OAAb,CAAqBa,eAArB,CAAqCuB,YAAY,CAACE,CAAD,CAAjD,EAAsDpC,IAAtD,CAA2D;AAAEC,4BAAAA,IAAI,EAAEL;AAAR,2BAA3D,CADyB;;AAAA;AAC9CgB,0BAAAA,YAD8C;AAAA,yEAGlD;AAAQ,4BAAA,GAAG,EAAEpB,KAAb;AAAoB,4BAAA,KAAK,EAAE2C,IAA3B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,6BAAmCvB,YAAY,CAAC,CAAD,CAA/C,CAHkD;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBAAjB;;AAAA;AAAA;AAAA;AAAA,kBAAZ,CALd;;AAAA;AAKLQ,cAAAA,UALK;;AAYX,oBAAKC,QAAL,CAAc;AAAEgB,gBAAAA,MAAM,EAAEjB,UAAV;AAAsBe,gBAAAA,IAAI,EAAED,YAAY,CAAC,CAAD,CAAxC;AAA6CT,gBAAAA,WAAW,EAAEb,YAAY,CAAC,CAAD,CAAtE;AAA2EG,gBAAAA,SAAS,EAAEH,YAAY,CAAC,CAAD;AAAlG,eAAd;;AAZW;AAAA;;AAAA;AAAA;AAAA;AAcXxB,cAAAA,kBAAkB,CAAC,QAAD,EAAW,OAAX,EAAoB,iCAApB,CAAlB;AACAmC,cAAAA,OAAO,CAACC,GAAR,CAAY,iCAAZ;;AAfW;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAvED;;AAAA,UA0Fdc,oBA1Fc;AAAA,2EA0FS,kBAAOC,CAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AACf9C,gBAAAA,KADe,GACP,MAAKA,KADE;AAErBA,gBAAAA,KAAK,CAAC8C,CAAC,CAACC,MAAF,CAASC,IAAV,CAAL,GAAuBF,CAAC,CAACC,MAAF,CAASE,KAAhC;;AACA,sBAAKrB,QAAL,CAAc5B,KAAd;;AAEQD,gBAAAA,KALa,GAKH,MAAKC,KALF,CAKbD,KALa;AAAA;AAAA,uBAMGH,IAAI,CAACK,GAAL,CAASC,WAAT,EANH;;AAAA;AAMfC,gBAAAA,SANe;AAAA;AAAA,uBAOMZ,YAAY,CAACc,OAAb,CAAqBa,eAArB,CAAqCnB,KAArC,EAA4CQ,IAA5C,CAAiD;AAAEC,kBAAAA,IAAI,EAAEL;AAAR,iBAAjD,CAPN;;AAAA;AAOfgB,gBAAAA,YAPe;;AASrB,sBAAKS,QAAL,CAAc;AAAEI,kBAAAA,WAAW,EAAEb,YAAY,CAAC,CAAD;AAA3B,iBAAd;;AATqB;AAAA,uBAUf,MAAKrB,aAAL,EAVe;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OA1FT;;AAAA;AAAA;AAAA;AAAA;;AAAA,UAuGdoD,mBAvGc,GAuGQ,UAACJ,CAAD,EAAO;AAC3B,UAAM9C,KAAK,GAAG,MAAKA,KAAnB;AACA8B,MAAAA,OAAO,CAACC,GAAR,CAAY,OAAZ,EAAqBe,CAAC,CAACC,MAAF,CAASC,IAA9B,EAAoCF,CAAC,CAACC,MAAF,CAASE,KAA7C;AACAjD,MAAAA,KAAK,CAAC8C,CAAC,CAACC,MAAF,CAASC,IAAV,CAAL,GAAuBF,CAAC,CAACC,MAAF,CAASE,KAAhC;;AACA,YAAKrB,QAAL,CAAc5B,KAAd;AACD,KA5Ga;;AAGZ,UAAKA,KAAL,GAAa;AACXmD,MAAAA,OAAO,EAAE,EADE;AAEXP,MAAAA,MAAM,EAAE,EAFG;AAGXQ,MAAAA,MAAM,EAAE,IAHG;AAIXrD,MAAAA,KAAK,EAAE,IAJI;AAKXiC,MAAAA,WAAW,EAAE,IALF;AAMXqB,MAAAA,KAAK,EAAE,IANI;AAOXxB,MAAAA,aAAa,EAAE;AAPJ,KAAb;AAUAjC,IAAAA,IAAI,GAAG,IAAIN,IAAJ,CAASgE,MAAM,CAACC,QAAhB,CAAP;AAbY;AAcb;;;;;;;;;;;uBAGO,KAAKhB,YAAL,E;;;qBACF,KAAKvC,KAAL,CAAWD,K;;;;;;uBACP,KAAKD,aAAL,E;;;;;;;;;;;;;;;;;;6BA2FD;AACP,0BACE;AAAK,QAAA,KAAK,EAAC,kBAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAK,QAAA,KAAK,EAAC,KAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAK,QAAA,KAAK,EAAC,YAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAK,QAAA,KAAK,EAAC,YAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAEE;AAAI,QAAA,KAAK,EAAE;AAAE0D,UAAAA,OAAO,EAAE;AAAX,SAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iCAFF,eAIE;AAAO,QAAA,KAAK,EAAC,MAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBAJF,eAKE;AAAQ,QAAA,SAAS,EAAC,iBAAlB;AAAoC,QAAA,IAAI,EAAC,MAAzC;AAAgD,QAAA,KAAK,EAAE,KAAKxD,KAAL,CAAWD,KAAX,IAAoB0D,SAA3E;AAAsF,QAAA,QAAQ,EAAE,KAAKZ,oBAArG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAQ,QAAA,KAAK,EAAC,EAAd;AAAiB,QAAA,QAAQ,MAAzB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wBADF,EAEG,KAAK7C,KAAL,CAAW0D,KAFd,CALF,eAQW;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QARX,eAQiB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QARjB,eAUE;AAAI,QAAA,KAAK,EAAC,QAAV;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,4BAVF,eAYE;AAAO,QAAA,EAAE,EAAC,UAAV;AAAqB,QAAA,KAAK,EAAC,0BAA3B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAI,QAAA,GAAG,EAAC,MAAR;AAAe,QAAA,KAAK,EAAC,QAArB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBADF,eAEE;AAAI,QAAA,GAAG,EAAC,UAAR;AAAmB,QAAA,KAAK,EAAC,QAAzB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBAFF,eAGE;AAAI,QAAA,GAAG,EAAC,MAAR;AAAe,QAAA,KAAK,EAAC,QAArB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0BAHF,eAIE;AAAI,QAAA,GAAG,EAAC,UAAR;AAAmB,QAAA,KAAK,EAAC,QAAzB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBAJF,CADF,CADF,eASE;AAAO,QAAA,KAAK,EAAC,mBAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACG,KAAK1D,KAAL,CAAW6B,aADd,CATF,CAZF,CADF,CADF,CADF,CADF;AAmCD;;;;EAnJ2BxC,S;;AAsJ9B,eAAeQ,eAAf","sourcesContent":["import React, { Component } from 'react';\nimport Web3 from 'web3';\nimport eventFactory from '../proxies/eventFactory';\nimport EventNFT from '../proxies/EventNFT';\nimport EventMarketplace from '../proxies/EventMarketplace';\nimport eventToken from '../proxies/EventToken';\nimport renderNotification from '../utils/notification-handler';\n\nlet web3;\n\nclass SecondaryMarket extends Component {\n  constructor() {\n    super();\n\n    this.state = {\n      tickets: [],\n      events: [],\n      ticket: null,\n      event: null,\n      marketplace: null,\n      price: null,\n      renderTickets: [],\n    };\n\n    web3 = new Web3(window.ethereum);\n  }\n\n  async componentDidMount() {\n    await this.updateEvents();\n    if (this.state.event) {\n      await this.updateTickets()\n    }\n  }\n\n  updateTickets = async () => {\n    try {\n      const { event } = this.state;\n      const initiator = await web3.eth.getCoinbase();\n      const nftInstance = await EventNFT(this.state.event);\n      const saleTickets = await nftInstance.methods.getTicketsForSale().call({ from: initiator });\n      const renderData = await Promise.all(saleTickets.map(async ticketId => {\n        const { purchasePrice, sellingPrice, forSale } = await nftInstance.methods.getTicketDetails(ticketId).call({ from: initiator });\n\n        const eventDetails = await eventFactory.methods.getEventDetails(event).call({ from: initiator });\n        const [eventName] = Object.values(eventDetails);\n\n        if (forSale) {\n          return (\n            <tr key={ticketId}>\n              <td class=\"center\">{eventName}</td>\n              <td class=\"center\">{ticketId}</td>\n              <td class=\"center\">{web3.utils.fromWei(sellingPrice, 'ether')}</td>\n\n              <td class=\"center\"><button type=\"submit\" className=\"custom-btn login-btn\" onClick={this.onPurchaseTicket.bind(this, ticketId, sellingPrice, initiator)}>Buy</button></td>\n            </tr>\n          );\n        }\n      }));\n\n      this.setState({ renderTickets: renderData });\n    } catch (err) {\n      renderNotification('danger', 'Error', 'Error wile updating sale tickets');\n      console.log('Error wile updating sale tickets', err);\n    }\n  }\n\n  onPurchaseTicket = async (ticketId, sellingPrice, initiator) => {\n    try {\n      const { marketplace } = this.state;\n      const marketplaceInstance = await EventMarketplace(marketplace);\n      await eventToken.methods.approve(marketplace, sellingPrice).send({ from: initiator, gas: 6700000 });\n      await marketplaceInstance.methods.secondaryPurchase(ticketId).send({ from: initiator, gas: 6700000 });\n      await this.updateTickets()\n\n      renderNotification('success', 'Success', 'Ticket purchased for the event successfully!');\n    } catch (err) {\n      renderNotification('danger', 'Error', err.message);\n      console.log('Error while purchasing the ticket', err);\n    }\n  }\n\n\n  updateEvents = async () => {\n    try {\n      const initiator = await web3.eth.getCoinbase();\n      const activeEvents = await eventFactory.methods.getActiveEvents().call({ from: initiator });\n      const eventDetails = await eventFactory.methods.getEventDetails(activeEvents[0]).call({ from: initiator });\n      const renderData = await Promise.all(activeEvents.map(async (fest, i) => {\n        const eventDetails = await eventFactory.methods.getEventDetails(activeEvents[i]).call({ from: initiator });\n        return (\n          <option key={event} value={fest} >{eventDetails[0]}</option>\n        )\n      }));\n\n      this.setState({ events: renderData, fest: activeEvents[0], marketplace: eventDetails[4], eventName: eventDetails[0] });\n    } catch (err) {\n      renderNotification('danger', 'Error', 'Error while updating the events');\n      console.log('Error while updating the events', err);\n    }\n  }\n\n  onEventChangeHandler = async (e) => {\n    const state = this.state;\n    state[e.target.name] = e.target.value;\n    this.setState(state);\n\n    const { event } = this.state;\n    const initiator = await web3.eth.getCoinbase();\n    const eventDetails = await eventFactory.methods.getEventDetails(event).call({ from: initiator });\n\n    this.setState({ marketplace: eventDetails[4] });\n    await this.updateTickets();\n  }\n\n  inputChangedHandler = (e) => {\n    const state = this.state;\n    console.log('input', e.target.name, e.target.value)\n    state[e.target.name] = e.target.value;\n    this.setState(state);\n  }\n\n  render() {\n    return (\n      <div class=\"container center\" >\n        <div class=\"row\">\n          <div class=\"container \">\n            <div class=\"container \">\n\n              <h5 style={{ padding: \"30px 0px 0px 10px\" }}>Secondary Marketplace</h5>\n\n              <label class=\"left\">Event</label>\n              <select className=\"browser-default\" name='fest' value={this.state.event || undefined} onChange={this.onEventChangeHandler}>\n                <option value=\"\" disabled >Select Event</option>\n                {this.state.fests}\n              </select><br /><br />\n\n              <h4 class=\"center\">Purchase Tickets</h4>\n\n              <table id='requests' class=\"responsive-table striped\" >\n                <thead>\n                  <tr>\n                    <th key='name' class=\"center\">Event Name</th>\n                    <th key='ticketId' class=\"center\">Ticket Id</th>\n                    <th key='cost' class=\"center\">Cost(in EVENT)</th>\n                    <th key='purchase' class=\"center\">Purchase</th>\n                  </tr>\n                </thead>\n                <tbody class=\"striped highlight\">\n                  {this.state.renderTickets}\n                </tbody>\n              </table>\n\n            </div>\n          </div>\n        </div>\n      </div >\n    )\n  }\n}\n\nexport default SecondaryMarket;"]},"metadata":{},"sourceType":"module"}